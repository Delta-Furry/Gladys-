<!DOCTYPE html> 
<html lang="en"> 
<head> 
  <meta charset="UTF-8" /> 
  <title>PIRATAS</title>
  <link rel="icon" type="image/jpg" href="./Assets/icongame.jpg"/>
  <style> 
    body { 
      margin: 0; 
      overflow: hidden; 
    } 
    #boton { 
      background-color: white;
      color: black;
      position: absolute; 
      width: 100%; 
      height: 100%; 
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center; 
      text-align: center; 
      font-size: 40px; 
      cursor: pointer; 
    } 
    #activ { 
      color: green; 
    } 
  </style>
</head>
<body>

<!-- BotÃ³n para activar pointerlock -->
<div id="boton"> Da clic en + para iniciar <p id="activ">(  )</p> Pulsa Esc para salir </div>
<canvas id="myCanvas"></canvas>

<!-- IMPORTMAP MODIFICADO -->
<script type="importmap"> 
{
  "imports": {
    "three": "./js/three.module.js",
    "three/VRButton": "./js/VRButton.js",
    "three/interactive": "./js/three.interactive.js"
  }
}
</script>

<!-- SCRIPT PRINCIPAL -->
<script type="module"> 
import * as THREE from 'three';
import { VRButton } from 'three/VRButton';
import { InteractionManager } from 'three/interactive';
import { TWEEN } from './js/tween.module.min.js';

// Importar escenarios
import ESC01 from "./js/Brenda_PREP.js"
import ESC02 from "./js/Crist_PREP.js"
import ESC03 from "./js/Mauricio_PREP.js"
import ESC04 from "./js/Lyn_PREP.js"

// Renderer
var renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById('myCanvas'),
  antialias: true,
});
renderer.setPixelRatio(window.devicePixelRatio); // corregido "decive" por "device"
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x85929E);
renderer.xr.enabled = true;
renderer.xr.setReferenceSpaceType('local');
document.body.appendChild(renderer.domElement);
document.body.appendChild(VRButton.createButton(renderer));

// Escena y cÃ¡mara
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, .1, 1000);
camera.position.set(0, 4, 40);
scene.add(camera);

// InteractionManager
var interactionManager = new InteractionManager(renderer, camera, renderer.domElement);

// Luz
var light1 = new THREE.AmbientLight(0xffffff, .2);
scene.add(light1);

// Cruz guÃ­a en el centro
var geometryx = new THREE.BoxGeometry(.0075, .05, .075); 
var materialx = new THREE.MeshNormalMaterial({side:THREE.DoubleSide}); 
var meshx = new THREE.Mesh(geometryx, materialx); 
meshx.position.set(0, 0, -1); 
var geometryx2 = new THREE.BoxGeometry(.05, .0075, .075); 
var meshx2 = new THREE.Mesh(geometryx2, materialx); 
meshx2.position.set(0, 0, -1); 
camera.add(meshx, meshx2);

// Base
var BASE = new THREE.BoxGeometry(300, 5, 300);
var materialbase = new THREE.MeshBasicMaterial({color:0x027290, side:THREE.DoubleSide});
var meshbase = new THREE.Mesh(BASE, materialbase);
meshbase.position.set(0, -15, 0);
scene.add(meshbase);

// Escenarios
scene.add(ESC01({x: 0, y: 0, z: 0}));
scene.add(ESC02({x: 0, y: 10, z: -200}));
scene.add(ESC03({x: -200, y: 10, z: -200}));
scene.add(ESC04({x: -200, y: 10, z: 0}));

// Cilindros interactivos
function crearCilindro(x, y, z, destinoX, destinoY, destinoZ) {
  var cilindro = new THREE.Mesh(
    new THREE.CylinderGeometry(10, 20, 20, 20),
    new THREE.MeshBasicMaterial({ color: 0x1def08, side: THREE.DoubleSide })
  );
  cilindro.position.set(x, y, z);
  scene.add(cilindro);

  // Interacciones
  cilindro.addEventListener('mouseover', (event) => {
    event.target.material.color.set(0xffffff);
    document.body.style.cursor = 'pointer';
  });
  cilindro.addEventListener('mouseout', (event) => {
    event.target.material.color.set(0xf61308);
    document.body.style.cursor = 'default';
  });
  cilindro.addEventListener('mousedown', (event) => {
    event.target.scale.set(1.1, 1.1, 1.1);
  });
  cilindro.addEventListener('click', (event) => {
    let coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
    new TWEEN.Tween(coords)
      .to({ x: destinoX, y: destinoY, z: destinoZ })
      .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
      .start();
  });

  interactionManager.add(cilindro);
}

// Crear dos cilindros interactivos
crearCilindro(300, 20, 30, 300, 50, 0);     // PL1
crearCilindro(-300, 20, 30, -300, 50, 0);   // PL2

// Redimensionamiento
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// ðŸŽ° Render loop con VR
function render() {
  TWEEN.update();
  interactionManager.update();
  renderer.render(scene, camera);
}
renderer.setAnimationLoop(render);

</script>
</body>
</html>
