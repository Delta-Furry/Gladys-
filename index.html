<!DOCTYPE html> 
<html lang="en"> 
<head> 
<meta charset="UTF-8" /> 
<title>PIRATAS</title>
<link rel="icon" type="image/jpg" href="./Assets/icongame.jpg"/>
<style> 
  body { 
      margin: 0; 
      overflow: hidden; 
  } 
  #boton { 
    background-color: white;
    color: black;
    position: absolute; 
    width: 100%; 
    height: 100%; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
    text-align: center; 
    font-size: 40px; 
    cursor: pointer; 
  } 
  #activ { 
    color: green; 
  } 
</style>
</head>
<body>

<!--Boton para activar el pointerlock-->
<div id="boton"> Da clic en + para inicar <p id="activ">(  )</p> pulsa Esc para salir </div>

<canvas id="myCanvas"></canvas>

<!-- IMPORTMAP CORREGIDO -->
<script type="importmap"> 
{
  "imports": {
    "three": "./js/three.module.js",
    "three/PointerLockControls": "./js/PointerLockControls.js",
    "three/interactive": "./js/three.interactive.js",
    "three/VRButton": "./js/VRButton.js"
  }
}
</script>

<script type="module"> 

// ðŸ‘‰ LibrerÃ­as
import * as THREE from 'three';
import { VRButton } from 'three/VRButton';
import { InteractionManager } from 'three/interactive';
import { TWEEN } from './js/tween.module.min.js';
import { PointerLockControls } from 'three/PointerLockControls'; 
import { FontLoader } from './js/FontLoader.js';
import { TextGeometry } from './js/TextGeometry.js';

// Escenarios
import ESC01 from "./js/Brenda_PREP.js"
import ESC02 from "./js/Crist_PREP.js"
import ESC03 from "./js/Mauricio_PREP.js"
import ESC04 from "./js/Lyn_PREP.js"

// Renderer
var renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById('myCanvas'),
  antialias: true,
});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0xf1948a);
renderer.xr.enabled = true;
renderer.xr.setReferenceSpaceType('local');
document.body.appendChild(renderer.domElement);
document.body.appendChild(VRButton.createButton(renderer));

// Escena y cÃ¡mara
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, .1, 1000);
camera.position.set(0, 4, 40);

// PointerLock
var controls = new PointerLockControls(camera, renderer.domElement);
document.getElementById('activ').onclick = () => {
  controls.lock();
};
controls.addEventListener('lock', () => {
  boton.style.display = 'none';
});
controls.addEventListener('unlock', () => {
  boton.style.display = '';
});

// Interaction Manager
var interactionManager = new InteractionManager(renderer, camera, renderer.domElement);

// Redimensionar
window.addEventListener('resize', () => {
  const width = window.innerWidth;
  const height = window.innerHeight;
  camera.aspect = width / height;
  camera.updateProjectionMatrix();
  renderer.setSize(width, height);
});

// Ayudas visuales
const gridHelper = new THREE.GridHelper(50,50);
const axesHelper = new THREE.AxesHelper(50);

// Luces
var light1 = new THREE.AmbientLight(0xffffff, .2);
light1.position.set(-200, 100, 0);
scene.add(light1);

// Cruz central
var geometryx = new THREE.BoxGeometry(.0075, .05, .075); 
var materialx = new THREE.MeshNormalMaterial({side:THREE.DoubleSide}); 
var meshx = new THREE.Mesh(geometryx, materialx); 
meshx.position.set(0, 0, -1); 
var geometryx2 = new THREE.BoxGeometry(.05, .0075, .075); 
var meshx2 = new THREE.Mesh(geometryx2, materialx); 
meshx2.position.set(0, 0, -1); 
scene.add(camera); 
camera.add(meshx, meshx2);

// Base
var BASE = new THREE.BoxGeometry(300, 5, 300);
var materialbase = new THREE.MeshBasicMaterial({color:0x027290, side:THREE.DoubleSide});
var meshbase = new THREE.Mesh(BASE, materialbase);
meshbase.position.set(0,-15,0);

// Escenarios
var escenarioBren = ESC01 ({x:0, y:0, z:0});
scene.add(escenarioBren);

var escenarioCris = ESC02 ({x:0, y:10, z:-200});
scene.add(escenarioCris);

var escenarioMau = ESC03 ({x:-200, y:10, z:-200});
scene.add(escenarioMau);

var escenarioLyn = ESC04 ({x:-200, y:10, z:0});
scene.add(escenarioLyn);

// Figuras interactuables
var cilindro1 = new THREE.CylinderGeometry(10,20,20,20);
var materialcilindro1 = new THREE.MeshBasicMaterial({color:0x1def08, side:THREE.DoubleSide});
var PL1 = new THREE.Mesh(cilindro1, materialcilindro1);
PL1.position.set(300, 20, 30);
scene.add(PL1);

var cilindro2 = new THREE.CylinderGeometry(10,20,20,20);
var materialcilindro2 = new THREE.MeshBasicMaterial({color:0x1def08, side:THREE.DoubleSide});
var PL2 = new THREE.Mesh(cilindro2, materialcilindro2);
PL2.position.set(-300, 20, 30);
scene.add(PL2);

// Interacciones
PL1.addEventListener('mouseover', (event) => {
  event.target.material.color.set(0xffffff);
  document.body.style.cursor = 'pointer';
});
PL1.addEventListener('mouseout', (event) => {
  event.target.material.color.set(0xf61308);
  document.body.style.cursor = 'default';
});
PL1.addEventListener('mousedown', (event) => {
  event.target.scale.set(1.1, 1.1, 1.1);
});
PL1.addEventListener('click', (event) => {
  var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
  new TWEEN.Tween(coords)
    .to({x:300, y: 50, z: 0})
    .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
    .start();
});

PL2.addEventListener('mouseover', (event) => {
  event.target.material.color.set(0xffffff);
  document.body.style.cursor = 'pointer';
});
PL2.addEventListener('mouseout', (event) => {
  event.target.material.color.set(0xf61308);
  document.body.style.cursor = 'default';
});
PL2.addEventListener('mousedown', (event) => {
  event.target.scale.set(1.1, 1.1, 1.1);
});
PL2.addEventListener('click', (event) => {
  var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
  new TWEEN.Tween(coords)
    .to({x:-300, y: 50, z: 0})
    .onUpdate(() => camera.position.set(coords.x, coords.y, coords.z))
    .start();
});

interactionManager.add(PL1);
interactionManager.add(PL2);

// ðŸŽ° Render animaciÃ³n con setAnimationLoop
function render() {
  TWEEN.update();
  interactionManager.update();
  renderer.render(scene, camera);
}
renderer.setAnimationLoop(render);

</script>
</body>
</html>
