<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>PIRATAS VR</title>
  <link rel="icon" type="image/jpg" href="icongame.jpg"/>
  <style>
    body { margin: 0; overflow: hidden; background: #85929E; }
    #boton {
      background: white; color: black;
      position: absolute; width: 100%; height: 100%;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      font-size: 40px;
      cursor: pointer; z-index: 10;
    }
    #boton p { font-size: 20px; }
    canvas { display: block; width:100vw; height:100vh; }
  </style>
</head>
<body>

<div id="boton">
  Da clic en + para iniciar VR
  <p>Recorrido en el mar ¬°DISFRUTA!</p>
  <p>(  ) pulsa Esc para salir</p>
</div>
<canvas id="myCanvas"></canvas>

<script type="importmap">
{
  "imports": {
    "three": "./js/three.module.js",
    "three/VRButton": "./js/VRButton.js",
    "tween": "./js/tween.module.min.js"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { VRButton } from 'three/VRButton';
import { TWEEN } from 'tween';
import ESC01 from "./js/Brenda_PREP.js";
import ESC02 from "./js/Crist_PREP.js";
import ESC03 from "./js/Mauricio_PREP.js";
import ESC04 from "./js/Lyn_PREP.js";

// üéÆ Render + VR
var canvas = document.getElementById('myCanvas');
var renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.xr.enabled = true;
document.body.appendChild(VRButton.createButton(renderer));

// üé¨ Escena
var scene = new THREE.Scene();
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

// üé• Jugador y c√°mara
var player = new THREE.Group();
scene.add(player);

var camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 4, 0);
player.add(camera);

// üì¶ Cubos para teletransportarse
var cubos = [];

function crearCubo(posicion, color) {
  var geo = new THREE.BoxGeometry(4, 4, 4);
  var mat = new THREE.MeshLambertMaterial({ color: color, transparent: true, opacity: 0.85 });
  var cubo = new THREE.Mesh(geo, mat);
  cubo.position.set(posicion.x, posicion.y, posicion.z);
  scene.add(cubo);
  cubos.push(cubo);
  return cubo;
}
// --- Mapa NE (mapa 1) ---
var cuboNE_centro = crearCubo({ x: 100, y: 5, z: -100 }, 0xff0000);      // Centro
var cuboNE_NE = crearCubo({ x: 200, y: 5, z: -200 }, 0x0000ff);          // Noreste
var cuboNE_NO = crearCubo({ x: 0, y: 5, z: -200 }, 0x00ff00);            // Noroeste
var cuboNE_SE = crearCubo({ x: 200, y: 5, z: 0 }, 0xff00ff);             // Sureste
var cuboNE_SO = crearCubo({ x: 0, y: 5, z: 0 }, 0xffff00);               // Suroeste

cubos.push(cuboNE_centro, cuboNE_NE, cuboNE_NO, cuboNE_SE, cuboNE_SO);
// --- Mapa NO (mapa 2) ---
var cuboNO_centro = crearCubo({ x: -100, y: 5, z: -100 }, 0x0099ff);     // Centro
var cuboNO_NE = crearCubo({ x: 0, y: 5, z: -200 }, 0x5500ff);            // Noreste
var cuboNO_NO = crearCubo({ x: -200, y: 5, z: -200 }, 0x00ffaa);         // Noroeste
var cuboNO_SE = crearCubo({ x: 0, y: 5, z: 0 }, 0xaa00ff);               // Sureste
var cuboNO_SO = crearCubo({ x: -200, y: 5, z: 0 }, 0xffaa00);            // Suroeste

cubos.push(cuboNO_centro, cuboNO_NE, cuboNO_NO, cuboNO_SE, cuboNO_SO);
  // --- Mapa SE (mapa 4) ---
var cuboSE_centro = crearCubo({ x: 100, y: 5, z: 100 }, 0xff6600);       // Centro
var cuboSE_NE = crearCubo({ x: 200, y: 5, z: 0 }, 0x0066ff);             // Noreste
var cuboSE_NO = crearCubo({ x: 0, y: 5, z: 0 }, 0x66ff00);               // Noroeste
var cuboSE_SE = crearCubo({ x: 200, y: 5, z: 200 }, 0xff00aa);           // Sureste
var cuboSE_SO = crearCubo({ x: 0, y: 5, z: 200 }, 0xffff66);             // Suroeste

cubos.push(cuboSE_centro, cuboSE_NE, cuboSE_NO, cuboSE_SE, cuboSE_SO);

// --- Mapa SO (mapa 3) ---
var cuboSO_centro = crearCubo({ x: -100, y: 5, z: 100 }, 0x66ff66);       // Centro
var cuboSO_NE = crearCubo({ x: 0, y: 5, z: 0 }, 0x6666ff);               // Noreste
var cuboSO_NO = crearCubo({ x: -200, y: 5, z: 0 }, 0xff6666);            // Noroeste
var cuboSO_SE = crearCubo({ x: 0, y: 5, z: 200 }, 0xff66ff);             // Sureste
var cuboSO_SO = crearCubo({ x: -200, y: 5, z: 200 }, 0x66ffff);          // Suroeste

cubos.push(cuboSO_centro, cuboSO_NE, cuboSO_NO, cuboSO_SE, cuboSO_SO);
  

// Importante: ya que cuboC se mueve a (0,0,-5) cuando clickeas en cuboC, cerramos el ciclo para que M lleve al punto inicial.

// üó∫Ô∏è Mapas
scene.add( ESC01({ x: 0, y: 0, z: 0 }) );
scene.add( ESC02({ x: 0, y: 10, z: -200 }) );
scene.add( ESC03({ x: -200, y: 10, z: -200 }) );
scene.add( ESC04({ x: -200, y: 10, z: 0 }) );

// üì° Raycaster
var raycaster = new THREE.Raycaster();
var mouse = new THREE.Vector2();
var tempMat = new THREE.Matrix4();

// üöÄ Movimiento
function moverA(x, y, z) {
  var inicio = { x: player.position.x, y: player.position.y, z: player.position.z };
  new TWEEN.Tween(inicio)
    .to({ x: x, y: y, z: z }, 800)
    .onUpdate(function () {
      player.position.set(inicio.x, inicio.y, inicio.z);
    })
    .start();
}

// Mapeo de cubo a destino para evitar if
var destinos = {};
destinos[cuboNE_centro.id] = { x: 0, y: 5, z: 0 };           // Centro NE a centro NO
destinos[cuboNE_NE.id] = { x: 300, y: 5, z: -300 };          // Noreste NE a m√°s noreste (fuera del mapa actual)
destinos[cuboNE_NO.id] = { x: 100, y: 5, z: -100 };          // Noroeste NE a centro NE
destinos[cuboNE_SE.id] = { x: 200, y: 5, z: 100 };           // Sureste NE a sureste de mapa SE
destinos[cuboNE_SO.id] = { x: 100, y: 5, z: 0 };    
  destinos[cuboNO_centro.id] = { x: -100, y: 5, z: 100 };         // Centro NO a centro SO
destinos[cuboNO_NE.id] = { x: 100, y: 5, z: 0 };                // Noreste NO a suroeste NE
destinos[cuboNO_NO.id] = { x: -300, y: 5, z: -300 };            // Noroeste NO a m√°s noroeste
destinos[cuboNO_SE.id] = { x: 0, y: 5, z: 0 };                  // Sureste NO a suroeste NE
destinos[cuboNO_SO.id] = { x: -100, y: 5, z: 100 };  
  destinos[cuboSE_centro.id] = { x: 0, y: 5, z: 200 };                 // Centro SE a centro SO
destinos[cuboSE_NE.id] = { x: 300, y: 5, z: 0 };                     // Noreste SE a m√°s noreste
destinos[cuboSE_NO.id] = { x: 100, y: 5, z: 100 };                   // Noroeste SE a centro SE
destinos[cuboSE_SE.id] = { x: 300, y: 5, z: 300 };                   // Sureste SE a m√°s sureste
destinos[cuboSE_SO.id] = { x: 100, y: 5, z: 300 };  
  destinos[cuboSO_centro.id] = { x: 100, y: 5, z: 100 };                 // Centro SO a centro SE
destinos[cuboSO_NE.id] = { x: 0, y: 5, z: 200 };                       // Noreste SO a sur de mapa SE
destinos[cuboSO_NO.id] = { x: -100, y: 5, z: 100 };                    // Noroeste SO a centro SO
destinos[cuboSO_SE.id] = { x: 0, y: 5, z: 300 };                       // Sureste SO a m√°s sur
destinos[cuboSO_SO.id] = { x: -300, y: 5, z: 300 };   

function moverSegunCubo(hitCubo) {
  var destino = destinos[hitCubo.id];
  destino && moverA(destino.x, destino.y, destino.z);
}

// üéØ Clic normal
window.addEventListener('click', function (e) {
  mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  var hit = raycaster.intersectObjects(cubos, false)[0];
  hit && moverSegunCubo(hit.object);
});

// üéÆ Controlador VR
var control = renderer.xr.getController(0);
control.addEventListener('select', function () {
  tempMat.identity().extractRotation(control.matrixWorld);
  raycaster.ray.origin.setFromMatrixPosition(control.matrixWorld);
  raycaster.ray.direction.set(0, 0, -1).applyMatrix4(tempMat);
  var hit = raycaster.intersectObjects(cubos, false)[0];
  hit && moverSegunCubo(hit.object);
});
scene.add(control);

// üéØ Mira en forma de cruz
var mira1 = new THREE.Mesh(new THREE.BoxGeometry(0.0075, 0.05, 0.075), new THREE.MeshNormalMaterial());
var mira2 = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.0075, 0.075), new THREE.MeshNormalMaterial());
mira1.position.set(0, 0, -1);
mira2.position.set(0, 0, -1);
camera.add(mira1, mira2);

// üü¢ Bot√≥n de inicio
document.getElementById('boton').onclick = function () {
  document.getElementById('boton').style.display = 'none';
};

// üîÅ Resize
window.addEventListener('resize', function () {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// üåÄ Render Loop
function render() {
  TWEEN.update();
  renderer.render(scene, camera);
}
renderer.setAnimationLoop(render);
</script>

</body>
</html>
